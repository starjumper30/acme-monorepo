<div class="movie-list-header">
  <mat-form-field>
    <mat-label>Genre</mat-label>
    <mat-select [formControl]="selectedGenre">
      <mat-option>--</mat-option>
      @for (genre of genres(); track genre.title) {
      <mat-option [value]="genre.title">{{genre.title}}</mat-option>
      }
    </mat-select>
  </mat-form-field>
  <mat-paginator
    [length]="totalMovies()"
    [pageSize]="pageSettings().perPage"
    [pageSizeOptions]="[6, 9, 30, 99]"
    [pageIndex]="pageSettings().page - 1"
    (page)="onPageChange($event)"
    aria-label="Select page"
  >
  </mat-paginator>
  @if(genresLoadingError()) {
  <mat-error>{{genresLoadingError()?.message}}</mat-error>
  } @if (isLoadingMovies()) {
  <p>Loading movies...</p>
  } @else if (moviesLoadingError()){ {{moviesLoadingError()?.message}} }
</div>

<div class="movie-list">
  @for (movie of movies(); track movie.title) {
  <mat-card class="movie-card" appearance="outlined">
    <mat-card-header>
      <mat-card-title-group>
        <mat-card-title>{{movie.title}}</mat-card-title>
        <mat-card-subtitle class="movie-card-subtitle"
          ><span>{{movie.releaseYear}}</span>
          <span>{{movie.runtime}}</span>
          <span>{{movie.rating}}</span></mat-card-subtitle
        >
        <mat-card-subtitle class="movie-card-rating"
          ><mat-icon
            aria-hidden="true"
            fontIcon="star"
            class="rating-icon"
          ></mat-icon>
          {{movie.ratingValue}}</mat-card-subtitle
        >
        @if (movie.posterUrl) {
        <img
          mat-card-md-image
          [src]="movie.posterUrl"
          alt="Poster for {{movie.title}}"
        />
        }
      </mat-card-title-group>
    </mat-card-header>
    <mat-card-content class="movie-card-content">
      <p>{{movie.summary}}</p>
      <mat-chip-set aria-label="Genres">
        @for (genre of movie?.genres; track genre) {
        <mat-chip [highlighted]="genre.title === selectedGenre.value"
          >{{genre.title}}</mat-chip
        >
        }
      </mat-chip-set>
    </mat-card-content>
  </mat-card>
  }
</div>
